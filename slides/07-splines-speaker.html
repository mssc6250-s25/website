<!DOCTYPE html>
<html lang="en"><head>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-b84e9dc6e68246e77ac4f52f8c844cc3.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.7">
<meta name="author" content="Dr.&nbsp;Cheng-Han Yu   Department of Mathematical and Statistical Sciences   Marquette University">
<title>MSSC 6250 - Spring 2025 – Splines and General Additive Models 〰️</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
<link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
<link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
<style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #24292e;  }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #24292e; } /* Normal */
    code span.al { color: #ff5555; font-weight: bold; } /* Alert */
    code span.an { color: #6a737d; } /* Annotation */
    code span.at { color: #d73a49; } /* Attribute */
    code span.bn { color: #005cc5; } /* BaseN */
    code span.bu { color: #d73a49; } /* BuiltIn */
    code span.cf { color: #d73a49; } /* ControlFlow */
    code span.ch { color: #032f62; } /* Char */
    code span.cn { color: #005cc5; } /* Constant */
    code span.co { color: #6a737d; } /* Comment */
    code span.cv { color: #6a737d; } /* CommentVar */
    code span.do { color: #6a737d; } /* Documentation */
    code span.dt { color: #d73a49; } /* DataType */
    code span.dv { color: #005cc5; } /* DecVal */
    code span.er { color: #ff5555; text-decoration: underline; } /* Error */
    code span.ex { color: #d73a49; font-weight: bold; } /* Extension */
    code span.fl { color: #005cc5; } /* Float */
    code span.fu { color: #6f42c1; } /* Function */
    code span.im { color: #032f62; } /* Import */
    code span.in { color: #6a737d; } /* Information */
    code span.kw { color: #d73a49; } /* Keyword */
    code span.op { color: #24292e; } /* Operator */
    code span.ot { color: #6f42c1; } /* Other */
    code span.pp { color: #d73a49; } /* Preprocessor */
    code span.re { color: #6a737d; } /* RegionMarker */
    code span.sc { color: #005cc5; } /* SpecialChar */
    code span.ss { color: #032f62; } /* SpecialString */
    code span.st { color: #032f62; } /* String */
    code span.va { color: #e36209; } /* Variable */
    code span.vs { color: #032f62; } /* VerbatimString */
    code span.wa { color: #ff5555; } /* Warning */
  </style>
<link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto-89909b91675dd12fd7ae7f00f958249a.css">
<link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
<link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
<link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
<link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
<style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
<meta property="og:title" content="Splines and General Additive Models r emo::ji('wavy_dash') – MSSC 6250 - Spring 2025">
<meta property="og:description" content="MSSC 6250 Statistical Machine Learning">
<meta property="og:site_name" content="MSSC 6250 - Spring 2025">
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-color="#447099" class="quarto-title-block center"><h1 class="title">Splines and General Additive Models 〰️</h1>
  <p class="subtitle">MSSC 6250 Statistical Machine Learning</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Dr.&nbsp;Cheng-Han Yu <br> Department of Mathematical and Statistical Sciences <br> Marquette University 
</div>
</div>
</div>

</section><section><section id="nonlinear-relationships" class="title-slide slide level1 center"><h1>Nonlinear Relationships</h1>

</section><section id="when-y-and-x-are-not-linearly-associated" class="slide level2"><h2>When <span class="math inline">\(y\)</span> and <span class="math inline">\(x\)</span> are Not Linearly Associated</h2>
<ul>
<li><p>Linear models can describe <em>non-linear</em> relationship.</p></li>
<li><p><a href="https://math4780-f23.github.io/website/slides/10-diag-linearity.html#/title-slide"><strong>Feature engineering</strong></a>: When <span class="math inline">\(y\)</span> and <span class="math inline">\(x\)</span> are not linearly associated, we <em>transform <span class="math inline">\(x\)</span> (sometimes also <span class="math inline">\(y\)</span>) so that <span class="math inline">\(y\)</span> and the transformed <span class="math inline">\(x\)</span> become linearly related</em>.</p></li>
</ul>
<div class="fragment">
<ul>
<li>Popular methods
<ul>
<li>Basis function approach
<ul>
<li><a href="https://math4780-f23.github.io/website/slides/11-poly-reg.html#/title-slide">Polynominal regression (MSSC 5780, ISL 7.1)</a></li>
<li><a href="https://math4780-f23.github.io/website/slides/11-poly-reg.html#/piecewise-polynomial-regression">Piecewise regression (MSSC 5780, ISL 7.3, 7.4)</a></li>
<li><span class="green"><strong>Regression splines</strong></span></li>
</ul>
</li>
<li><a href="https://math4780-f23.github.io/website/slides/12-nonpara-reg.html#/title-slide">Local regression (MSSC 5780, ISL 7.6)</a></li>
<li><span class="green"><strong>Smoothing splines</strong></span></li>
<li><span class="green"><strong>General additive models (GAMs)</strong></span></li>
</ul>
</li>
</ul>
</div>
</section><section id="polynomial-regression" class="slide level2"><h2>Polynomial Regression</h2>
<ul>
<li>The <strong><span class="math inline">\(d\)</span>th-order (degree)</strong> polynomial model in <strong>one</strong> variable is <span class="math display">\[y = \beta_0 + \beta_1 x + \beta_2 x^2 + \cdots + \beta_dx^d + \epsilon\]</span>
</li>
</ul>

<img data-src="images/07-splines/unnamed-chunk-2-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:90.0%"><ul>
<li>We extend the simple linear regression by mapping <span class="math inline">\(x\)</span> to <span class="math inline">\((x, x^2, \dots, x^d)\)</span>.</li>
</ul>
<aside class="notes"><ul>
<li>
<em>“Bayesian Deep Learning and a Probabilistic Perspective of Generalization”</em> Wilson and Izmailov (2020) for the rationale of choosing a super high-order polynomial as the regression model.</li>
<li>Extra flexibility produces undesirable results at the boundaries. Generally speaking, it is unusual to use d greater than 3 or 4 because for large values of d, the polynomial curve can become overly flexible and can take on some very strange shapes. This is especially true near the boundary of the X variable.</li>
<li>centering, collinearity</li>
</ul><style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside></section><section id="basis-function-approach" class="slide level2"><h2><a href="https://www.cs.princeton.edu/courses/archive/fall18/cos324/files/basis-functions.pdf">Basis Function Approach</a></h2>
<ul>
<li>A set of <strong>basis functions</strong> or transformations that can be applied to a variable <span class="math inline">\(x\)</span>:<span class="math display">\[[b_1(x), b_2(x), \dots , b_K(x)]\]</span>
</li>
<li>
<strong>(Adaptive) basis function model</strong>: <span class="math display">\[y = \beta_0 + \beta_1 b_1(x) + \beta_2 b_2(x) + \cdots + \beta_K b_K(x) + \epsilon\]</span>
</li>
</ul>
<div class="question">
<p>Is polynomial regression a basis function approach?</p>
</div>
<div class="fragment">
<ul>
<li>
<em>Monomial basis</em>: <span class="math inline">\(\phi(x) = [1, x, x^2, \dots, x^K, \dots]\)</span>
</li>
<li>
<em>Fourier series basis</em>: <span class="math inline">\(\phi(x) = [1, \cos(\omega_1x + \psi_1), \cos(\omega_2x + \psi_2), \dots]\)</span>
</li>
<li><a href="https://en.wikipedia.org/wiki/B-spline#:~:text=In%20the%20mathematical%20subfield%20of,B%2Dsplines%20of%20that%20degree."><em>B-Spline basis</em></a></li>
</ul>
<div class="callout callout-important callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Important</strong></p>
</div>
<div class="callout-content">
<div style="font-size: 1.2em;">
<p><span class="math inline">\([b_1(x), b_2(x), \dots , b_K(x)]\)</span> are <strong>fixed</strong> and <strong>known</strong>.</p>
</div>
</div>
</div>
</div>
<aside class="notes"><style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</div>
</section><section id="piecewise-regression" class="slide level2"><h2>Piecewise regression</h2>
<ul>
<li><p>Polynomial regression imposes a <em>global</em> structure on the non-linear function.</p></li>
<li><p>Piecewise regression allows <em>structural changes in different parts of the range of <span class="math inline">\(x\)</span></em></p></li>
</ul>
<p><span class="math display">\[y=\begin{cases}
    \beta_{01} + \beta_{11}x+ \beta_{21}x^2 +\epsilon     &amp; \quad \text{if } x &lt; \xi\\
    \beta_{02} + \beta_{12}x+ \beta_{22}x^2+\beta_{32}x^3+\epsilon      &amp; \quad \text{if } x \ge \xi
  \end{cases}\]</span></p>
<ul>
<li><p>The joint points of pieces are called <strong>knots</strong>.</p></li>
<li><p>Using more knots leads to a more flexible piecewise polynomial.</p></li>
</ul>
<div class="question">
<p>With <span class="math inline">\(K\)</span> different knots, how many different polynomials do we have?</p>
</div>
<aside class="notes"><ul>
<li>A polynomial regression may provide a poor fit, and increasing the order does not improve the situation.</li>
<li>This may happen when the regression function behaves differently in different parts of the range of x .</li>
</ul><style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside></section><section id="piecewise-constant-and-linear-regression" class="slide level2"><h2>Piecewise Constant and Linear Regression</h2>
<div class="xsmall">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure><p><img data-src="./images/07-splines/piecewise_linear.png" style="width:100.0%"></p>
<figcaption>Source: ESL Fig. 5.1</figcaption></figure>
</div>
</div>
</div>
</div>
</section><section id="u.s.-birth-rate-from-1917-to-2003" class="slide level2"><h2>U.S. Birth Rate from 1917 to 2003<sup>1</sup>
</h2>
<div class="columns">
<div class="column" style="width:25%;">
<div class="midi">
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource my_class1 number-lines code-with-copy"><code class="sourceCode"><span id="cb1-1"><a></a>     Year Birthrate</span>
<span id="cb1-2"><a></a>1917 1917       183</span>
<span id="cb1-3"><a></a>1918 1918       184</span>
<span id="cb1-4"><a></a>1919 1919       163</span>
<span id="cb1-5"><a></a>1920 1920       180</span>
<span id="cb1-6"><a></a>1921 1921       181</span>
<span id="cb1-7"><a></a>1922 1922       173</span>
<span id="cb1-8"><a></a>1923 1923       168</span>
<span id="cb1-9"><a></a>1924 1924       177</span>
<span id="cb1-10"><a></a>1925 1925       172</span>
<span id="cb1-11"><a></a>1926 1926       170</span>
<span id="cb1-12"><a></a>1927 1927       164</span>
<span id="cb1-13"><a></a>1928 1928       152</span>
<span id="cb1-14"><a></a>1929 1929       145</span>
<span id="cb1-15"><a></a>1930 1930       145</span>
<span id="cb1-16"><a></a>1931 1931       139</span>
<span id="cb1-17"><a></a>1932 1932       132</span>
<span id="cb1-18"><a></a>1933 1933       126</span>
<span id="cb1-19"><a></a>1934 1934       130</span>
<span id="cb1-20"><a></a>1935 1935       130</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div><div class="column" style="width:75%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure><p><img data-src="images/07-splines/unnamed-chunk-5-1.png" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div></div>
<aside><ol class="aside-footnotes"><li id="fn1"><p>The data is only for illustrating ideas of different methods. The methods introduced here are best for inference about relationship between variables of some physical or natural system, not mainly for time series forecasting.</p></li></ol></aside></section><section id="a-polynomial-regression-provide-a-poor-fit" class="slide level2"><h2>A Polynomial Regression Provide a Poor Fit</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lmfit3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Birthrate</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span><span class="op">(</span><span class="va">Year</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Year</span><span class="op">)</span>, degree <span class="op">=</span> <span class="fl">3</span>, raw <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,  </span>
<span>             data <span class="op">=</span> <span class="va">birthrates</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure><p><img data-src="images/07-splines/unnamed-chunk-7-1.png" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure><p><img data-src="images/07-splines/unnamed-chunk-8-1.png" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div></div>
<aside class="notes"><p><code>raw</code> if true, use raw and not orthogonal polynomials. https://stackoverflow.com/questions/19484053/what-does-the-r-function-poly-really-do - A polynomial regression may provide a poor fit, and increasing the order does not improve the situation. - This may happen when the regression function behaves differently in different parts of the range of x.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside></section><section id="piecewise-polynomials-3-knots-at-1936-60-78" class="slide level2"><h2>Piecewise Polynomials: 3 knots at 1936, 60, 78</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="midi">
<p><span class="math display">\[y=\begin{cases}
    \beta_{01} + \beta_{11}x+ \epsilon &amp; \text{if } x &lt; 1936\\
    \beta_{02} + \beta_{12}x+\epsilon  &amp; \text{if } 1936 \le x &lt; 1960 \\
    \beta_{03} + \beta_{13}x+\epsilon  &amp; \text{if } 1960 \le x &lt; 1978 \\
    \beta_{04} + \beta_{14}x+\epsilon  &amp; \text{if } 1978 \le x
  \end{cases}\]</span></p>
</div>
</div><div class="column" style="width:60%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure><p><img data-src="images/07-splines/unnamed-chunk-9-1.png" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div></div>
<div class="question">
<p>Any issue of piecewise polynomials?</p>
</div>
<aside class="notes"><ul>
<li>Discontinuity at knots.</li>
<li>Because the regression is too flexible in some sense, allowing two different estimates at knots.</li>
</ul><style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside></section></section><section><section id="regression-splines" class="title-slide slide level1 center"><h1>Regression Splines</h1>
<div style="font-size: 1.5em;">
<p>Piecewise polynomials + Continuity/Differentiability at knots</p>
</div>
</section><section id="splines" class="slide level2"><h2>Splines</h2>
<p><strong>Splines</strong> of degree <span class="math inline">\(d\)</span> are <em>smooth piecewise polynomials</em> of degree <span class="math inline">\(d\)</span> with <strong>continuity in derivatives</strong> (smoothing) up to degree <span class="math inline">\(d-1\)</span> <em>at each knot</em>.</p>
<div class="fragment">
<h4 id="continuous-piecewise-linear-regression">Continuous Piecewise Linear Regression</h4>
<div class="columns">
<div class="column" style="width:33%;">
<div class="xsmall">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure><p><img data-src="./images/07-splines/piecewise_conti_linear.png" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</div><div class="column" style="width:67%;">
<div class="xsmall">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure><p><img data-src="./images/07-splines/piecewise_linear.png" style="width:100.0%"></p>
<figcaption>Source: ESL Fig. 5.1</figcaption></figure>
</div>
</div>
</div>
</div>
</div></div>
</div>
</section><section id="piecewise-linear-to-continuous-piecewise-linear" class="slide level2"><h2>Piecewise Linear to Continuous Piecewise Linear</h2>
<p>How do we turn the piecewise regression of degree 1 into a regression spline?</p>
<div class="midi">
<p><span class="math display">\[y=\begin{cases}
    \beta_{01} + \beta_{11}x+ \epsilon &amp; \quad \text{if } x &lt; 1936\\
    \beta_{02} + \beta_{12}x+\epsilon  &amp; \quad \text{if } 1936 \le x &lt; 1960 \\
    \beta_{03} + \beta_{13}x+\epsilon  &amp; \quad \text{if } 1960 \le x &lt; 1978 \\
    \beta_{04} + \beta_{14}x+\epsilon  &amp; \quad \text{if } 1978 \le x
  \end{cases}\]</span></p>
</div>
<div class="fragment">
<ul>
<li>For splines of degree 1, we require <em>continuous</em> piecewise linear function</li>
</ul>
<div class="clolumns">
<div class="column">
<p><span class="math display">\[\begin{align}
\beta_{01} + \beta_{11}1936 &amp;= \beta_{02} + \beta_{12}1936\\
\beta_{02} + \beta_{12}1960 &amp;= \beta_{03} + \beta_{13}1960\\
\beta_{03} + \beta_{13}1978 &amp;= \beta_{04} + \beta_{14}1978
\end{align}\]</span></p>
</div><div class="column">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure><p><img data-src="images/07-splines/unnamed-chunk-12-1.png" class="quarto-figure quarto-figure-center" style="width:60.0%"></p>
</figure>
</div>
</div>
</div>
</div></div>
</div>
</section><section id="splinesbs" class="slide level2"><h2><code>splines::bs()</code></h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lin_sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Birthrate</span> <span class="op">~</span> <span class="fu">splines</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/splines/bs.html">bs</a></span><span class="op">(</span><span class="va">Year</span>, degree <span class="op">=</span> <span class="fl">1</span>, knots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1936</span>, <span class="fl">1960</span>, <span class="fl">1978</span><span class="op">)</span><span class="op">)</span>, </span>
<span>             data <span class="op">=</span> <span class="va">birthrates</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="images/07-splines/unnamed-chunk-13-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"><ul>
<li><p>The function is continuous everywhere, also at knots <span class="math inline">\(\xi_1, \xi_2,\)</span> and <span class="math inline">\(\xi_3\)</span>, i.e.&nbsp;<span class="math inline">\(f_{k}(\xi_k^-) = f_{k+1}(\xi_k^+)\)</span>.</p></li>
<li><p>Linear everywhere except <span class="math inline">\(\xi_1, \xi_2,\)</span> and <span class="math inline">\(\xi_3\)</span>.</p></li>
<li><p>Has a different slope for each region.</p></li>
</ul></section><section id="sec-linearspline" class="slide level2"><h2>Splines as Basis Function Model</h2>
<p>For linear splines with 3 knots,</p>
<p><span class="math display">\[\begin{align}
b_1(x) &amp;= x\\
b_2(x) &amp;= (x - \xi_1)_+\\
b_3(x) &amp;= (x - \xi_2)_+\\
b_4(x) &amp;= (x - \xi_3)_+
\end{align}\]</span> where</p>
<!-- - $\xi_k, k = 1, 2, 3$ are knots -->
<ul>
<li>
<span class="math inline">\((x - \xi_k)_+\)</span> is a <em>truncated power basis function</em> (of power one) such that</li>
</ul>
<p><span class="math display">\[(x - \xi_k)_+=\begin{cases}
    x - \xi_k &amp; \quad \text{if }x &gt; \xi_k\\
    0  &amp; \quad \text{otherwise}
  \end{cases}\]</span></p>
<p><span class="math display">\[\begin{align} y &amp;= \beta_0 + \beta_1 b_1(x) + \beta_2 b_2(x) + \beta_3 b_3(x) + \beta_4 b_4(x) + \epsilon\\
&amp;=\beta_0 + \beta_1 x + \beta_2 (x - \xi_1)_+ + \beta_3 (x - \xi_2)_+ + \beta_4 (x - \xi_3)_+ + \epsilon
\end{align}\]</span></p>
</section><section id="linear-splines-basis-functions" class="slide level2"><h2>Linear Splines Basis Functions</h2>

<img data-src="images/07-splines/unnamed-chunk-14-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section><section id="splines-as-basis-function-model" class="slide level2"><h2>Splines as Basis Function Model<sup>1</sup>
</h2>
<p>With degree <span class="math inline">\(d\)</span> and <span class="math inline">\(K\)</span> knots, the regression spline with <em>first <span class="math inline">\(d-1\)</span> derivatives being continuous</em> at the knots can be represented as</p>
<p><span class="math display">\[\begin{align} y &amp;= \beta_0 + \beta_1 b_1(x) + \beta_2 b_2(x) + \dots + \beta_d b_d(x) + \beta_{d+1}b_{d+1}(x) + \dots + \beta_{d+K}b_{d+K}(x) + \epsilon
\end{align}\]</span> where</p>
<ul>
<li><p><span class="math inline">\(b_j(x) = x^j, j = 1, 2, \dots, d\)</span></p></li>
<li><p><span class="math inline">\(b_{d+k} = (x - \xi_k)^{d}_+, k = 1, \dots, K\)</span> where <span class="math display">\[(x - \xi_k)^d_+=\begin{cases}
  (x - \xi_k)^d &amp; \quad \text{if }x &gt; \xi_k\\
  0  &amp; \quad \text{otherwise}
\end{cases}\]</span></p></li>
</ul>
<div class="question">
<p>Can you write the model with <span class="math inline">\(d = 2\)</span> and <span class="math inline">\(K = 3\)</span>?</p>
</div>
<aside><ol class="aside-footnotes"><li id="fn2"><p>Besides truncated power basis, we can represent the splines using another set of basis functions, for example <a href="https://en.wikipedia.org/wiki/B-spline#:~:text=A%20B%2Dspline%20function%20is,using%20a%20number%20of%20points.">B-Splines</a> which is more computationally convenient and numerically accurate.</p></li></ol></aside></section><section id="cubic-splines" class="slide level2"><h2>Cubic Splines<sup>1</sup>
</h2>
<ul>
<li>The <strong>cubic spline</strong> is a spline of <em>degree 3</em> with <em>first 2 derivatives are continuous at the knots</em>.</li>
</ul>
<p><span class="math display">\[\begin{align} y &amp;= \beta_0 + \beta_1 x + \beta_2 x^2 + \beta_3 x^3 + \sum_{k = 1}^K \beta_{k+3} (x - \xi_k)_+^3 + \epsilon
\end{align}\]</span></p>
<ul>
<li>Smooth at knots because
<ul>
<li><span class="math inline">\(f(\xi_k^-) = f(\xi_k^+)\)</span></li>
<li><span class="math inline">\(f'(\xi_k^-) = f'(\xi_k^+)\)</span></li>
<li><span class="math inline">\(f''(\xi_k^-) = f''(\xi_k^+)\)</span></li>
<li>But <span class="math inline">\(f^{(3)}(\xi_k^-) \ne f^{(3)}(\xi_k^+)\)</span>
</li>
</ul>
</li>
</ul><aside><ol class="aside-footnotes"><li id="fn3"><p>Cubic splines are popular because most human eyes cannot detect the discontinuity at the knots.</p></li></ol></aside></section><section id="degrees-of-freedom" class="slide level2"><h2>Degrees of Freedom</h2>
<ul>
<li><p>In regression, <strong>(effective) degrees of freedom (df)</strong> can be viewed as <em>the number of regression coeffcients that are freely to move.</em></p></li>
<li><p>It measures the model complexity/flexiblity. The larger df is, the more flexible the model is.</p></li>
</ul>
<div class="fragment">
<ul>
<li>
<span class="green"><em>Piecewise linear</em></span>: <em>3 knots, 4 linear regressions, and 8 dfs.</em>
</li>
</ul>
<div class="midi">
<p><span class="math display">\[y=\begin{cases}
    \beta_{01} + \beta_{11}x+ \epsilon &amp; \quad \text{if } x &lt; 1936\\
    \beta_{02} + \beta_{12}x+\epsilon  &amp; \quad \text{if } 1936 \le x &lt; 1960 \\
    \beta_{03} + \beta_{13}x+\epsilon  &amp; \quad \text{if } 1960 \le x &lt; 1978 \\
    \beta_{04} + \beta_{14}x+\epsilon  &amp; \quad \text{if } 1978 \le x
  \end{cases}\]</span></p>
</div>
</div>
<div class="fragment">
<ul>
<li>
<span class="green"><em>Linear splines</em></span> (continuous piecewise linear): <em>8 - 3 constraints = 5 dfs.</em> (Check its <a href="#/sec-linearspline">basis representation</a>)</li>
</ul>
<div class="midi">
<p><span class="math display">\[\begin{align}
\beta_{01} + \beta_{11}1936 &amp;= \beta_{02} + \beta_{12}1936\\
\beta_{02} + \beta_{12}1960 &amp;= \beta_{03} + \beta_{13}1960\\
\beta_{03} + \beta_{13}1978 &amp;= \beta_{04} + \beta_{14}1978
\end{align}\]</span></p>
</div>
<aside class="notes"><p>talk about effective df, so that we know the model flexibility and complexity of a regression spline model</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</div>
</section><section id="degrees-of-freedom-1" class="slide level2"><h2>Degrees of Freedom</h2>
<ul>
<li>With degree <span class="math inline">\(d\)</span> and <span class="math inline">\(K\)</span> knots,</li>
</ul>
<p><span class="math display">\[\text{df} = K + d + 1\]</span></p>
<!-- - This leads to a total of [(4 + # knots)]{.green} degrees of freedom. -->
<div class="fragment">
<div class="question">
<p>So what is the degrees of freedom of cubic splines?</p>
</div>
<aside class="notes"><ul>
<li>With degree <span class="math inline">\(d\)</span> and <span class="math inline">\(K\)</span> knots,</li>
</ul>
<p><span class="math display">\[\begin{align} \text{df} &amp;= \text{(# regions)} \times \text{(# coefficients)} - \text{(# constraints)} \times \text{(# knots)}\\
&amp;=(K + 1)(d + 1) - dK\\
&amp;= K + d + 1 \end{align} \]</span></p>
<!-- - This leads to a total of [(4 + # knots)]{.green} degrees of freedom. -->
<p>. . .</p>
<ul>
<li>
<span class="green"><em>Cubic splines</em></span>:</li>
</ul>
<p>We have 3 constraints:</p>
<ul>
<li>continuity <span class="math inline">\(f(\xi ^ {-}) = f(\xi ^ {+})\)</span>
</li>
<li>1st derivative <span class="math inline">\(f'(\xi ^ {-}) = f'(\xi ^ {+})\)</span>
</li>
<li>2nd derivative <span class="math inline">\(f''(\xi ^ {-}) = f''(\xi ^ {+})\)</span>
</li>
</ul>
<p><span class="math inline">\(\text{df} = \text{(# regions)} \times \text{(# coef)} - \text{(# constraints)} \times \text{(# knots)} = (K + 1)4 - 3K = 4 + K\)</span></p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</div>
</section><section id="cubic-splines-1" class="slide level2"><h2>Cubic Splines</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cub_sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Birthrate</span> <span class="op">~</span> <span class="fu">splines</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/splines/bs.html">bs</a></span><span class="op">(</span><span class="va">Year</span>, degree <span class="op">=</span> <span class="fl">3</span>, knots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1936</span>, <span class="fl">1960</span>, <span class="fl">1978</span><span class="op">)</span><span class="op">)</span>, </span>
<span>             data <span class="op">=</span> <span class="va">birthrates</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="images/07-splines/unnamed-chunk-15-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:49.0%"></section><section id="natural-splines" class="slide level2"><h2>Natural Splines</h2>
<ul>
<li>Splines<sup>1</sup> tends to produce erratic and undesirable results near the boundaries, and huge variance at the outer range of the predictors.</li>
</ul>
<div class="fragment">
<ul>
<li>A <strong>natural spline</strong> is a regression spline with additional <em>boundary constraints</em>:
<ul>
<li>The spline function is <em>linear at the boundary</em> (in the region where <span class="math inline">\(X\)</span> is smaller than the smallest knot, or larger than the largest knot).</li>
</ul>
<!-- + $f^{(k)}(x) = 0$ for $x < \xi_1$ and $x > \xi_K$ where $f^{(k)}(\cdot)$ is the $k$-th derivative of the spline function $f$. -->
</li>
</ul>
</div>
<div class="fragment">
<ul>
<li><p>Natural splines generally produce more stable estimates at the boundaries.</p></li>
<li><p>Assuming linearity near the boundary is reasonable since there is less information available there.</p></li>
</ul>
<!-- - The natural cubic  --><ul>
<li><code><a href="https://rdrr.io/r/splines/ns.html">splines::ns()</a></code></li>
</ul>
</div>
<div class="fragment">
<ul>
<li><p><strong>Natural Cubic Spline (NCS)</strong> forces the 2nd and 3rd derivatives to be zero at the boundaries.</p></li>
<li><p>The constraints frees up 4 dfs.</p></li>
<li><p>The df of NCS is <span class="math inline">\(K\)</span>.</p></li>
</ul>
</div>
<aside><ol class="aside-footnotes"><li id="fn4"><p>Especially for high-degree polynomials.</p></li></ol></aside></section><section id="spline-and-natural-spline-comparison" class="slide level2"><h2>Spline and Natural Spline Comparison</h2>
<ul>
<li>Cubic Spline vs.&nbsp;Natural Cubic Spline with the same degrees of freedom 6.</li>
</ul>

<img data-src="images/07-splines/unnamed-chunk-16-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"><aside class="notes"><p>https://stackoverflow.com/questions/17930140/extracting-knot-points-from-glm-when-using-bs-in-r-as-a-variable attr(fit.bs$terms, “predvars”)</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside></section><section id="practical-issues" class="slide level2"><h2>Practical Issues</h2>
<ul>
<li>
<span class="green">How many knots should we use</span>
<ul>
<li>
<em>As few knots as possible, with at least 5 data points per segment</em> (Wold, 1974)</li>
<li><em>Cross-validation: e.g., choose the <span class="math inline">\(K\)</span> giving the smallest <span class="math inline">\(MSE_{CV}\)</span></em></li>
</ul>
</li>
</ul>
<div class="fragment">
<ul>
<li>
<span class="green">Where to place the knots</span>
<ul>
<li>
<em>No more than one extreme or inflection point per segment</em> (Wold, 1974)</li>
<li>If possible, <em>the extreme points should be centered in the segment</em>
</li>
<li><em>More knots in places where the function might vary most rapidly, and fewer knots where it seems more stable</em></li>
<li><em>Place knots in a uniform fashion</em></li>
<li>
<em>Specify the desired df, and have the software place the corresponding number of knots at uniform quantiles of the data</em> (<code><a href="https://rdrr.io/r/splines/bs.html">bs()</a></code>, <code><a href="https://rdrr.io/r/splines/ns.html">ns()</a></code>)</li>
</ul>
</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>
<span class="green">Degree of functions in each region</span>
<ul>
<li><em>Use <span class="math inline">\(d &lt; 4\)</span> to avoid overly flexible curve fitting</em></li>
<li><em>Cubic spline is popular</em></li>
</ul>
</li>
</ul>
<aside class="notes"><p>Too many knots can overfit Regression splines often give superior results to polynomial regression</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</div>
</section></section><section><section id="smoothing-splines" class="title-slide slide level1 center"><h1>Smoothing Splines</h1>

</section><section id="roughness-penalty-approach" class="slide level2"><h2>Roughness Penalty Approach</h2>
<ul>
<li><p>Our goal is <em>inference or curve fitting</em> rather than out of range prediction or forecasting.</p></li>
<li><p>Is there a method that we can select the number and location of knots automatically?</p></li>
</ul>
<p>Consider this criterion for fitting a <em>smooth</em> function <span class="math inline">\(g(x)\)</span> to some data:</p>
<p><span class="math display">\[\begin{equation} \min_{g} \sum_{i=1}^n \left( y_i - g(x_i) \right)^2 + \lambda \int g''(t)^2 \, dt \end{equation}\]</span></p>
<ul>
<li><p>The first term is <span class="math inline">\(SS_{res}\)</span>, and tries to make <span class="math inline">\(g(x)\)</span> match the data at each <span class="math inline">\(x_i\)</span>. (<span class="green">Goodness-of-fit</span>)</p></li>
<li><p>The second term with <span class="math inline">\(\lambda \ge 0\)</span> is a <span class="green"><em>roughness penalty</em></span> and controls how wiggly <span class="math inline">\(g(x)\)</span> is.</p></li>
</ul>
<!-- - The tuning parameter $\lambda \ge 0$. --><div class="fragment">
<div style="font-size: 3.5em;">
<div style="text-align: center;">
<blockquote>
<p><strong>Loss + Penalty</strong></p>
</blockquote>
</div>
</div>
<aside class="notes"><ul>
<li>2nd term: penalizes the variability in g</li>
<li>the second derivative of a function is a measure of its roughness</li>
<li>the integral simply a measure of the total change in the function g′(t), over its entire range</li>
</ul><style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</div>
</section><section id="roughness-penalty-approach-1" class="slide level2"><h2>Roughness Penalty Approach</h2>
<p><span class="math display">\[\begin{equation} \min_{g} \sum_{i=1}^n \left( y_i - g(x_i) \right)^2 + \lambda \int g''(t)^2 \, dt \end{equation}\]</span></p>
<div class="question">
<p>How <span class="math inline">\(\lambda\)</span> affects the shape of <span class="math inline">\(g(x)\)</span>?</p>
</div>
<ul>
<li><p>The smaller <span class="math inline">\(\lambda\)</span> is, the more wiggly <span class="math inline">\(g(x)\)</span> is, eventually interpolating <span class="math inline">\(y_i\)</span> when <span class="math inline">\(\lambda = 0\)</span>.</p></li>
<li><p>As <span class="math inline">\(\lambda \rightarrow \infty\)</span>, <span class="math inline">\(g(x)\)</span> becomes linear.</p></li>
<li><p>The function <span class="math inline">\(g\)</span> that minimizes the objective is known as a <strong>smoothing spline</strong>.</p></li>
</ul>
<div class="fragment">
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<div style="font-size: 1.2em;">
<ul>
<li>The solution <span class="math inline">\(\hat{g}\)</span> is a <span class="green">natural cubic spline</span>, with knots at <span class="math inline">\(x_1, x_2, \dots , x_n\)</span>!</li>
<li>But, it is not the same NCS gotten from the basis function approach.</li>
<li>It is a <em>shrunken</em> version where <span class="math inline">\(\lambda\)</span> controls the level of shrinkage.</li>
<li>Its <em>effective</em> df is less than <span class="math inline">\(n\)</span>.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</section><section id="properties-of-smoothing-splines" class="slide level2"><h2>Properties of Smoothing splines</h2>
<ul>
<li>Smoothing splines avoid the knot-selection issue, leaving a single <span class="math inline">\(\lambda\)</span> to be chosen.</li>
</ul>
<div class="columns">
<div class="column" style="width:50%;">
<p><span class="green"><strong>Linear regression</strong></span></p>
<ul>
<li><p><span class="math inline">\(\hat{\mathbf{y}} = \bf H \mathbf{y}\)</span> where <span class="math inline">\(\bf H\)</span> is the hat matrix</p></li>
<li><p>The degrees of freedom <span class="math inline">\((\text{# coef})\)</span> is <span class="math display">\[p = \sum_{i=1}^n {\bf H}_{ii}\]</span></p></li>
<li><p>PRESS for model selection</p></li>
</ul>
<p><span class="math display">\[\begin{align} PRESS &amp;= \sum_{i = 1}^n \left( y_i - \hat{y}_i^{(-i)}\right)^2 \\
&amp;= \sum_{i = 1}^n \left[ \frac{y_i - \hat{y}_i}{1 - {\bf H}_{ii}}\right]^2\end{align}\]</span></p>
</div><div class="column" style="width:50%;">
<p><span class="green"><strong>Smoothing splines</strong></span></p>
<ul>
<li><p><span class="math inline">\(\hat{\mathbf{g}}_{\lambda} = {\bf S}_{\lambda} \mathbf{y}\)</span> where <span class="math inline">\(\bf {\bf S}_{\lambda}\)</span> is the <strong>smoother matrix</strong>.</p></li>
<li><p>The effective degrees of freedom <span class="math inline">\((\text{# coef})\)</span> is <span class="math display">\[df_{\lambda} = \sum_{i=1}^n \{{\bf S}_{\lambda}\}_{ii} \in [2, n]\]</span></p></li>
<li><p>LOOCV for choosing <span class="math inline">\(\lambda\)</span><sup>1</sup></p></li>
</ul>
<p><span class="math display">\[\begin{align} (SS_{res})_{CV}(\lambda) &amp;= \sum_{i = 1}^n \left( y_i - \hat{g}_{\lambda}^{(-i)}(x_i)\right)^2 \\
&amp;= \sum_{i = 1}^n \left[ \frac{y_i - \hat{g}_{\lambda}(x_i)}{1 - \{{\bf S}_{\lambda}\}_{ii}}\right]^2 \end{align}\]</span></p>
</div></div>
<aside><ol class="aside-footnotes"><li id="fn5"><p>GCV can be used too.</p></li></ol></aside></section><section id="smooth.spline" class="slide level2"><h2><code>smooth.spline()</code></h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/smooth.spline.html">smooth.spline</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">df</span>, <span class="va">lambda</span>, cv <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>
<code>cv = TRUE</code> use LOOCV; <code>cv = FALSE</code> use GCV</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/smooth.spline.html">smooth.spline</a></span><span class="op">(</span><span class="va">birthrates</span><span class="op">$</span><span class="va">Year</span>, <span class="va">birthrates</span><span class="op">$</span><span class="va">Birthrate</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="images/07-splines/unnamed-chunk-22-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"><div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fit</span><span class="op">$</span><span class="va">df</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 60.8</code></pre>
</div>
</div>
<aside class="notes"><p>overfitting since the birthrate data has little variation in adjacent years</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside></section><section id="smooth.spline-1" class="slide level2"><h2><code>smooth.spline()</code></h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/smooth.spline.html">smooth.spline</a></span><span class="op">(</span><span class="va">birthrates</span><span class="op">$</span><span class="va">Year</span>, <span class="va">birthrates</span><span class="op">$</span><span class="va">Birthrate</span>, df <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="images/07-splines/unnamed-chunk-24-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section></section><section><section id="generalized-additive-models" class="title-slide slide level1 center"><h1>Generalized Additive Models</h1>

</section><section id="extending-splines-to-multiple-variables" class="slide level2"><h2>Extending Splines to Multiple Variables</h2>
<ul>
<li><p>All methods discussed so far are extensions of simple linear regression.</p></li>
<li><p>How to flexibly predict <span class="math inline">\(y\)</span> or nonlinear regression function on the basis of several predictors <span class="math inline">\(x_1, \dots, x_p\)</span>?</p></li>
</ul>
<div class="fragment">
<p>Maintaining the <em>additive</em> structure of linear models, but allowing nonlinear functions of each of the variables.</p>
<p><span class="math display">\[y = \beta_0 + f_1(x_1) + f_2(x_2) + \dots + f_p(x_p) + \epsilon\]</span></p>
<ul>
<li>This is a <strong>generalized additive model</strong>.
<ul>
<li>It’s <em>general</em>: it can be modelling response with other distributions, binary, counts, positive values, for example.</li>
<li>It’s <em>additive</em>: calculate a separate <span class="math inline">\(f_j\)</span> for each <span class="math inline">\(x_j\)</span>, and add together all of their contributions.</li>
</ul>
</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>
<span class="math inline">\(f_1(x_1) = x_1\)</span>; <span class="math inline">\(f_2(x_2) = x_2 + x_2^2\)</span>; <span class="math inline">\(f_3(x_3) = \text{cubic splines}\)</span>
</li>
</ul>
</div>
</section><section id="wage-data-in-isl" class="slide level2"><h2>
<code>Wage</code> data in ISL</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.statlearning.com">ISLR2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/attach.html">attach</a></span><span class="op">(</span><span class="va">Wage</span><span class="op">)</span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">Wage</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<div class="sourceCode" id="cb13"><pre class="sourceCode numberSource my_class600 number-lines code-with-copy"><code class="sourceCode"><span id="cb13-1"><a></a>Rows: 3,000</span>
<span id="cb13-2"><a></a>Columns: 11</span>
<span id="cb13-3"><a></a>$ year       &lt;int&gt; 2006, 2004, 2003, 2003, 2005, 2008, 2009, 2008, 2006, 2004,…</span>
<span id="cb13-4"><a></a>$ age        &lt;int&gt; 18, 24, 45, 43, 50, 54, 44, 30, 41, 52, 45, 34, 35, 39, 54,…</span>
<span id="cb13-5"><a></a>$ maritl     &lt;fct&gt; 1. Never Married, 1. Never Married, 2. Married, 2. Married,…</span>
<span id="cb13-6"><a></a>$ race       &lt;fct&gt; 1. White, 1. White, 1. White, 3. Asian, 1. White, 1. White,…</span>
<span id="cb13-7"><a></a>$ education  &lt;fct&gt; 1. &lt; HS Grad, 4. College Grad, 3. Some College, 4. College …</span>
<span id="cb13-8"><a></a>$ region     &lt;fct&gt; 2. Middle Atlantic, 2. Middle Atlantic, 2. Middle Atlantic,…</span>
<span id="cb13-9"><a></a>$ jobclass   &lt;fct&gt; 1. Industrial, 2. Information, 1. Industrial, 2. Informatio…</span>
<span id="cb13-10"><a></a>$ health     &lt;fct&gt; 1. &lt;=Good, 2. &gt;=Very Good, 1. &lt;=Good, 2. &gt;=Very Good, 1. &lt;=…</span>
<span id="cb13-11"><a></a>$ health_ins &lt;fct&gt; 2. No, 2. No, 1. Yes, 1. Yes, 1. Yes, 1. Yes, 1. Yes, 1. Ye…</span>
<span id="cb13-12"><a></a>$ logwage    &lt;dbl&gt; 4.32, 4.26, 4.88, 5.04, 4.32, 4.85, 5.13, 4.72, 4.78, 4.86,…</span>
<span id="cb13-13"><a></a>$ wage       &lt;dbl&gt; 75.0, 70.5, 131.0, 154.7, 75.0, 127.1, 169.5, 111.7, 118.9,…</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section><section id="gamgam" class="slide level2"><h2><code>gam::gam()</code></h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">gam</span><span class="op">)</span></span>
<span><span class="va">gam.m3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gam/man/gam.html">gam</a></span><span class="op">(</span><span class="va">wage</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/gam/man/gam.s.html">s</a></span><span class="op">(</span><span class="va">year</span>, df <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/gam/man/gam.s.html">s</a></span><span class="op">(</span><span class="va">age</span> , df <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span> <span class="va">education</span>, data <span class="op">=</span> <span class="va">Wage</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><p><code><a href="https://rdrr.io/pkg/gam/man/gam.s.html">s()</a></code> for smoothing splines</p></li>
<li><p>Coefficients not that interesting; fitted functions are.</p></li>
</ul>

<img data-src="images/07-splines/unnamed-chunk-27-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"><aside class="notes"><p>upper and lower pointwise twice-standard-error curves are included</p>
<p>The left-hand panel indicates that holding age and education fixed, wage tends to increase slightly with year; this may be due to inflation. The center panel indicates that holding education and year fixed, wage tends to be highest for intermediate values of age, and lowest for the very young and very old.</p>
<ul>
<li><p>Because the model is additive, we can examine the effect of each <span class="math inline">\(X_j\)</span> on <span class="math inline">\(Y\)</span> individually while holding all of the other variables fixed.</p></li>
<li><p>Allow to fit a non-linear <span class="math inline">\(f_j\)</span> to each <span class="math inline">\(X_j\)</span>, so that we can automatically model non-linear relationships that standard linear regression will miss.</p></li>
<li><p>No need to manually try out many different transformations on each variable individually.</p></li>
<li><p>The non-linear fits can potentially make more accurate predictions for the response.</p></li>
<li><p>The smoothness of the function <span class="math inline">\(f_j\)</span> for the variable <span class="math inline">\(X_j\)</span> can be summarized via degrees of freedom.</p></li>
<li><p>The model is additive. For fully general models, we look for more flexible approaches such as random forests and boosting.</p></li>
</ul><style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside><!-- ## GAM fitting {visibility="hidden"} --><!-- - Natural splines `lm(wage ~ ns(year, df = 5) + ns(age, df = 5) + education)` --><!-- - Can mix terms, e.g., smoothing splines and local regression --><!-- `gam(wage ~ s(year, df = 5) + lo(age, span = .5) + education)` --><!-- - Can add interactions, e.g. `ns(age, df = 5):ns(year, df = 5)` --><!-- - Use `anova()` to compare models. --><!-- ## Summary of GAMs {visibility="hidden"} --><!-- - Allow to fit a non-linear $f_j$ to each $X_j$, so that we can --><!-- automatically model non-linear relationships that standard linear regression will miss. --><!-- - No need to manually try out many different transformations on each variable individually. --><!-- - The non-linear fits can potentially make more accurate predictions for the response. --><!-- - The smoothness of the function $f_j$ for the variable $X_j$ can be summarized via degrees of freedom. --><!-- - The model is additive. For fully general models, we look for more flexible approaches such as random forests and boosting. --><!-- ::: notes --><!-- - Because the model is additive, we can examine the effect of each $X_j$ on $Y$ individually while holding all of the other variables fixed. --><!-- - The smoothness of the function $f_j$ for the variable $X_j$ can be summarized via degrees of freedom. --><!-- ::: --><!-- ## Other Topics --><!-- - [Basis spline (B-spline) definition (de Boor, 1978)](https://en.wikipedia.org/wiki/B-spline#:~:text=A%20B%2Dspline%20function%20is,using%20a%20number%20of%20points.): more computationally efficient --><!-- - Algorithms for fitting GAMs using smoothing splines: [Backfitting](https://en.wikipedia.org/wiki/Backfitting_algorithm), ISL Sec 7.9 Exercise 11. --><!-- - GAMs for binary response and classification. --><!-- - [Multivariate Adaptive Regression Splines (MARS)](https://en.wikipedia.org/wiki/Multivariate_adaptive_regression_spline#:~:text=In%20statistics%2C%20multivariate%20adaptive%20regression,nonlinearities%20and%20interactions%20between%20variables.) --><!-- ::: notes --><!-- How many knots should be used --><!-- Where to place the knots --><!-- What is the degree of functions in each region --><!-- we can control that using the df parameter. We use a total of 6 parameters, chosen by the function automatically. However, this does not seems to perform better than the knots we implemented. The choice of knots can be crucial. --><!-- ::: -->

</section></section>
</div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="https://upload.wikimedia.org/wikipedia/commons/e/e8/Marquette_Golden_Eagles_logo.svg" class="slide-logo"></p>
<div class="footer footer-default">
<p><a href="https://mssc6250-s25.github.io/website/">mssc6250-s25.github.io/website</a></p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="../site_libs/revealjs/dist/reveal.js"></script><!-- reveal.js plugins --><script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script><script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script><script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script><script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script><script src="../site_libs/revealjs/plugin/multiplex/socket.io.js"></script><script src="../site_libs/revealjs/plugin/multiplex/multiplex.js"></script><script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script><script src="../site_libs/revealjs/plugin/notes/notes.js"></script><script src="../site_libs/revealjs/plugin/search/search.js"></script><script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script><script src="../site_libs/revealjs/plugin/math/math.js"></script><script>window.define = window.backupDefine; window.backupDefine = undefined;</script><script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'multiplex': {"secret":"17392453296434810273","id":"81ee0b485b8959af","url":"https://reveal-multiplex.glitch.me/"},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1800,

        height: 1000,

        // Factor of the display size that should remain empty around the content
        margin: 5.0e-2,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script><script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script><script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp("https:\/\/mssc6250-s25\.github\.io\/website\/");
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>


</body></html>